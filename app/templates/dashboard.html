<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="icon" type="image/x-icon" href="/static/favicon.png">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <!-- Toastify (for toasts) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <!-- SweetAlert2 (for confirmation dialogs) -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</head>
<body>
<main>
    <div class="container">
        <div class="header">
            <h1 class="d-flex align-items-center">
                Your Tracked Contracts
                <!-- Help Icon next to header text -->
                <i id="helpBtn" class="material-icons help-icon" title="How to use?">info_outline</i>
            </h1>
            <!-- Add Contract Button -->
            <button id="addContractBtn" class="icon-button" title="Add Contract">
                <i class="material-icons" style="font-size:24px; color:#4CAF50;">add</i>
            </button>

        </div>

        <div id="contractsList" class="contracts-list"></div>


    </div>
</main>

<footer class="site-footer">
    <p>
        Source: <a href="https://github.com/perites/ETContactsChecker-Server" target="_blank">GitHub</a> |
        Have a question or improvement in mind? Write to me in
        <a href="https://t.me/perites" target="_blank">telegram</a>
        or
        <a href="mailto:nikita.krementar@gmail.com">email</a>

    </p>
</footer>


<!-- Help / Info Modal -->
<div id="helpModal" class="overlay hidden">
    <div class="popup-form">
        <h2>About</h2>
        <p>
            This site lets you monitor your contract’s contact count and sends Slack notifications when the limit is
            reached. Contacts count and alerts are updated every hour.
        </p>

        <h2>How to use</h2>

        <h3>Step 1 — Create a Data Extension</h3>
        <ol>
            <li>In your root capsule, create a new Data Extension.</li>
            <li>Add a single field:</li>
            <ul>
                <li><strong>Name:</strong> SubscriberCount</li>
                <li><strong>Data Type:</strong> Number</li>
            </ul>
        </ol>

        <h3>Step 2 — Create the Automation in Automation Studio</h3>
        <ol>
            <li>Go to <strong>Automation Studio → New Automation → SQL Query</strong>.</li>
            <li>
                Create a new SQL Query with the following query:
                <pre style="background:#3a3a3a; padding:10px; border-radius:8px; overflow-x:auto; margin-top:6px;">
SELECT COUNT(*) AS SubscriberCount
FROM _Subscribers</pre>

            </li>
            <li>
                Set the automation to <strong>run every hour</strong> and target the Data Extension created in Step 1.
            </li>
        </ol>

        <h3>Step 3 — Add information to this site</h3>
        <ol>
            <li>Press the <strong>+</strong> button in the top-left corner.</li>
            <li>Fill in all the required fields:</li>
        </ol>

        <div class="info-note">
            <strong>Note:</strong> To find “Prod fields”: go to
            <a href="https://prodepc.com/pages/brand/oauth-connection" target="_blank" rel="noopener noreferrer"
               class="green-link"><strong>Prod OAuth connections</strong></a>, search for your contract, and press
            <strong>Update</strong>.


        </div>

        <table class="info-table">
            <thead>
            <tr>
                <th>Field</th>
                <th>Description</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td><strong>Contract Name</strong></td>
                <td>Any name that identifies your contract</td>
            </tr>
            <tr>
                <td><strong>Slack Users IDs</strong></td>
                <td>

                    Slack users IDs of people who should receive notifications about this contract (comma-separated;
                    copy each User ID
                    from their Slack profile)


                </td>
            </tr>
            <tr>
                <td><strong>SFMC Subdomain</strong></td>
                <td>API Endpoint from Prod</td>
            </tr>
            <tr>
                <td><strong>Client ID</strong></td>
                <td>Client ID from Prod</td>
            </tr>
            <tr>
                <td><strong>Client Secret</strong></td>
                <td>Client Secret from Prod</td>
            </tr>
            <tr>
                <td><strong>DE Key</strong></td>
                <td>External Key of the Data Extension created in Step 1</td>
            </tr>
            <tr>
                <td><strong>Contacts Limit</strong></td>
                <td>Contact threshold that triggers a Slack warning</td>
            </tr>
            </tbody>
        </table>

        <button type="button" id="closeHelpBtn" class="cancel" style="margin-top:18px;">Close</button>
    </div>
</div>


<!-- Add/Edit Form (popup) -->
<div id="formOverlay" class="overlay hidden">
    <form id="contractForm" class="popup-form">
        <h2 id="formTitle">Add Contract</h2>
        <input type="text" name="name" placeholder="Name" required>
        <input type="text" name="slack_users_ids" placeholder="Slack User IDs (comma-separated)" required>
        <input type="text" name="sfmc_subdomain" placeholder="SFMC Subdomain" required>
        <input type="text" name="client_id" placeholder="Client ID" required>
        <input type="password" name="client_secret" placeholder="Client Secret" required>
        <input type="text" name="de_key" placeholder="DE Key" required>
        <input type="number" name="contacts_limit" placeholder="Contacts Limit" required>
        <button type="submit">Save</button>
        <button type="button" id="cancelBtn" class="cancel">Cancel</button>
    </form>
</div>

<script src="/static/script.js"></script>
</body>
</html>
